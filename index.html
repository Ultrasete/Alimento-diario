<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="theme-color" content="#e11d48">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Sistema Vida 31.1 - Clean Edition</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Lora:ital,wght@0,400;1,400&family=Dancing+Script:wght@600&family=Montserrat:wght@400;700&family=Bebas+Neue&family=Permanent+Marker&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* --- ESTILOS BASE --- */
        :root { 
            --primary: #e11d48; --primary-light: #ffebf0;
            --bg-body: #f4f6f9; --bg-card: #ffffff; 
            --text-main: #1e293b; --text-sec: #64748b;
            --border: #e2e8f0; --input-bg: #f8fafc; 
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.08);
        }
        [data-theme="dark"] { 
            --primary: #fb7185; --primary-light: #2d1b20;
            --bg-body: #0f172a; --bg-card: #1e293b; 
            --text-main: #f1f5f9; --text-sec: #94a3b8;
            --border: #334155; --input-bg: #334155; 
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-body); color: var(--text-main); padding-bottom: 120px; transition: 0.3s; overflow-x: hidden; position: relative; }

        /* PARTICLES BACKGROUND */
        #particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; overflow: hidden; }
        .particle { position: absolute; background: var(--primary); border-radius: 50%; opacity: 0.2; animation: floatUp linear infinite; }
        @keyframes floatUp { 0% { transform: translateY(100vh) scale(0); opacity: 0; } 50% { opacity: 0.5; } 100% { transform: translateY(-10vh) scale(1); opacity: 0; } }

        /* HEADER */
        header { 
            background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; 
            position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); 
        }
        [data-theme="dark"] header { background: rgba(15, 23, 42, 0.8); }
        .brand span:first-child { font-weight: 800; font-size: 1.1rem; color: var(--primary); display:block; line-height:1; }
        .brand span:last-child { font-size: 0.65rem; color: var(--text-sec); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        
        .streak-badge { 
            background: linear-gradient(135deg, #f59e0b, #d97706); 
            color: white; padding: 6px 12px; border-radius: 20px; 
            font-size: 0.75rem; font-weight: 700; display: flex; align-items: center; gap: 6px; 
            box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);
            cursor: pointer; transition: transform 0.2s;
        }
        .streak-badge:active { transform: scale(0.95); }

        .container { padding: 20px; max-width: 600px; margin: 0 auto; }
        .screen { display: none; opacity: 0; transform: translateY(15px); transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .screen.active { display: block; opacity: 1; transform: translateY(0); }

        /* EDITOR */
        .tools-section { background: var(--bg-card); padding: 20px; border-radius: 24px; border: 1px solid var(--border); margin-bottom: 20px; box-shadow: var(--shadow); position: relative; z-index: 1; }
        .section-title { font-size: 0.8rem; font-weight: 700; color: var(--text-sec); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        
        .search-row { display: flex; gap: 10px; margin-bottom: 15px; position: relative; }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-sec); opacity: 0.5; }
        .search-input { flex: 1; padding: 14px 14px 14px 40px; border-radius: 16px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); outline: none; transition: 0.3s; }
        .search-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-light); }
        
        .btn-magic { background: linear-gradient(135deg, var(--primary), #db2777); color: white; border: none; width: 54px; border-radius: 16px; cursor: pointer; font-size: 1.2rem; box-shadow: 0 4px 15px rgba(225, 29, 72, 0.3); transition: 0.2s; }
        .btn-magic:active { transform: scale(0.9); }

        .cat-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; mask-image: linear-gradient(to right, black 90%, transparent 100%); -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%); }
        .cat-chip { background: var(--input-bg); padding: 10px 18px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; color: var(--text-sec); white-space: nowrap; cursor: pointer; border: 1px solid var(--border); transition: 0.2s; }
        .cat-chip:active { transform: scale(0.95); }
        .cat-chip.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(225, 29, 72, 0.2); }

        .emoji-bar { margin-bottom: 15px; }
        .btn-emoji-toggle { width: 100%; background: var(--input-bg); border: 1px solid var(--border); padding: 12px; border-radius: 14px; color: var(--text-sec); font-weight: 600; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-emoji-toggle:hover { background: var(--border); }
        .emoji-grid { display: none; grid-template-columns: repeat(8, 1fr); gap: 5px; background: var(--bg-card); padding: 10px; border-radius: 16px; border: 1px solid var(--border); margin-top: 10px; max-height: 180px; overflow-y: auto; }
        .emoji-grid.show { display: grid; }
        .emoji-item { font-size: 1.5rem; cursor: pointer; padding: 6px; text-align: center; border-radius: 8px; transition: 0.2s; }
        .emoji-item:hover { background: var(--input-bg); transform: scale(1.2); }

        .form-group { margin-bottom: 20px; }
        label { display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; font-weight: 700; margin-bottom: 8px; color: var(--text-sec); text-transform: uppercase; letter-spacing: 0.5px; }
        input, textarea { width: 100%; padding: 16px; border-radius: 18px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); font-size: 1rem; outline: none; transition: 0.3s; font-family: inherit; }
        input:focus, textarea:focus { border-color: var(--primary); background: var(--bg-card); }

        /* --- PREVIEW UI (MOBILE FIRST) --- */
        .top-nav-bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .btn-back { background: none; border: none; color: var(--text-sec); font-weight: 600; display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 0; }
        .btn-inspire { background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; border: none; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); transition: 0.2s; }
        .btn-inspire:active { transform: scale(0.95); }

        /* Slider Box (Topo) */
        .slider-box {
            background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; 
            padding: 15px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 15px; box-shadow: var(--shadow);
        }
        .slider-row { display: flex; gap: 15px; }
        .slider-wrapper { flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .slider-label { font-size: 0.65rem; font-weight: 800; color: var(--text-sec); text-transform: uppercase; display: flex; justify-content: space-between; }
        input[type=range] { width: 100%; -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: var(--primary); cursor: pointer; margin-top: -7px; box-shadow: 0 2px 6px rgba(225, 29, 72, 0.4); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: var(--border); border-radius: 2px; }

        /* CART√ÉO (DESTAQUE) - Estilo Vidro 2.0 + 3D TILT */
        .preview-container-3d { perspective: 1000px; width: 100%; display: flex; justify-content: center; margin-bottom: 25px; }
        
        .card-preview-wrapper { 
            width: 100%; aspect-ratio: 4/5; border-radius: 32px; text-align: center; 
            position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; 
            padding: 40px; background-color: white; 
            box-shadow: 0 20px 60px -10px rgba(0,0,0,0.25); 
            transition: transform 0.1s ease-out, box-shadow 0.1s ease-out; /* Smoother tilt */
            border: 1px solid rgba(255,255,255,0.2);
            transform-style: preserve-3d;
        }

        /* FRAMES (MOLDURAS) - V31 */
        .frame-white { border: 12px solid #ffffff; }
        .frame-black { border: 12px solid #1e293b; }
        .frame-gold { border: 12px solid #d4af37; box-shadow: inset 0 0 20px rgba(184, 134, 11, 0.5); }
        .frame-wood { border: 15px solid #8b4513; border-radius: 4px !important; }
        .frame-neon-pink { border: 4px solid #ff00ff; box-shadow: 0 0 15px #ff00ff, inset 0 0 15px #ff00ff; }
        .frame-neon-blue { border: 4px solid #00ffff; box-shadow: 0 0 15px #00ffff, inset 0 0 15px #00ffff; }
        .frame-double { border: 8px solid white; outline: 4px solid rgba(0,0,0,0.1); outline-offset: -14px; }
        .frame-modern-y { border-top: 20px solid var(--primary); border-bottom: 20px solid var(--primary); }
        .frame-modern-x { border-left: 20px solid var(--primary); border-right: 20px solid var(--primary); }
        .frame-polaroid-clean { border: 15px solid white; border-bottom-width: 50px; border-radius: 2px !important; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* DRAGGABLE ITEMS (V28) */
        .draggable-item {
            cursor: grab;
            touch-action: none; /* Critical for drag */
            position: relative;
            z-index: 10;
            transition: transform 0.05s linear; /* Responsive follow */
            user-select: none;
        }
        .draggable-item:active {
            cursor: grabbing;
            z-index: 50;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
        }

        /* FORMATOS BAR */
        .format-bar { 
            display: flex; gap: 8px; justify-content: center; margin-bottom: 15px; 
            background: var(--bg-card); padding: 6px; border-radius: 20px; border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }
        .fmt-btn { 
            flex: 1; padding: 10px; border-radius: 14px; border: 1px solid transparent; 
            background: transparent; color: var(--text-sec); font-size: 0.8rem; font-weight: 700; 
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: 0.2s;
        }
        .fmt-btn:hover { background: var(--input-bg); }
        .fmt-btn.active { background: var(--text-main); color: var(--bg-body); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

        /* OUTRAS FERRAMENTAS (CARROSSEL) */
        .scroll-tools { display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px; }
        
        .tool-row { 
            display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none; padding: 4px 2px 10px 2px; white-space: nowrap;
        }
        
        .tool-btn { 
            flex: 0 0 auto; padding: 10px 18px; border-radius: 14px; border: 1px solid var(--border); 
            background: var(--bg-card); color: var(--text-sec); font-size: 0.85rem; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; gap: 8px; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .tool-btn:active { transform: scale(0.95); }
        .tool-btn.active { background: var(--primary-light); color: var(--primary); border-color: var(--primary); box-shadow: 0 4px 10px rgba(225, 29, 72, 0.15); }

        /* TEMAS */
        .preview-controls { 
            display: flex; flex-direction: row; flex-wrap: nowrap; gap: 14px; overflow-x: auto; align-items: center; 
            scrollbar-width: none; padding: 10px 5px 25px 5px; margin-bottom: 0;
        }
        .theme-btn { 
            flex: 0 0 auto; width: 60px; height: 60px; border-radius: 18px; border: 3px solid transparent; 
            cursor: pointer; position: relative; background-size: cover; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 1.2rem; color: rgba(255,255,255,0.9); box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: 0.3s;
        }
        .theme-btn:hover { transform: translateY(-3px); }
        .theme-btn.active { border-color: var(--primary); transform: scale(1.1); box-shadow: 0 10px 25px rgba(225, 29, 72, 0.3); z-index: 10; }
        .theme-btn.upload-btn { border: 2px dashed var(--text-sec); color: var(--text-sec); box-shadow: none; background: var(--input-bg); }
        
        /* MAGIC BTN */
        .theme-btn.magic-btn { background: linear-gradient(135deg, #a855f7, #ec4899); color: white; border: none; }

        /* VIP LOCK */
        .theme-btn.locked { filter: grayscale(100%) opacity(0.7); }
        .theme-btn.locked::after { content: '\f023'; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; background: rgba(0,0,0,0.6); color: white; width: 100%; height: 100%; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; backdrop-filter: blur(2px); }

        /* ASSETS VISUAIS */
        .fmt-feed { aspect-ratio: 4/5; border-radius: 28px; }
        .fmt-square { aspect-ratio: 1/1; border-radius: 28px; }
        .fmt-story { aspect-ratio: 9/16; border-radius: 0; }
        .fmt-music { aspect-ratio: 4/5; border-radius: 24px; }

        .card-sticker { position: absolute; top: 25px; right: 25px; z-index: 10; background: rgba(255,255,255,0.95); padding: 8px 16px; border-radius: 30px; font-size: 0.75rem; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); display: none; backdrop-filter: blur(5px); transform: translateZ(20px); /* 3D pop */ }
        .card-sticker.visible { display: block; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        /* MUSIC PLAYER OVERLAY */
        .music-overlay { 
            position: absolute; bottom: 20px; left: 0; width: 100%; padding: 0 30px; 
            z-index: 8; display: none; flex-direction: column; gap: 8px; transform: translateZ(10px);
        }
        .fmt-music .music-overlay { display: flex; }
        .fmt-music .pv-footer { display: none; }
        
        .music-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; position: relative; }
        .music-progress { width: 65%; height: 100%; background: white; border-radius: 2px; }
        .music-time { display: flex; justify-content: space-between; font-size: 0.6rem; color: rgba(255,255,255,0.8); font-weight: 600; margin-top: 4px; font-family: 'Montserrat', sans-serif; }
        .music-controls { display: flex; justify-content: center; gap: 20px; align-items: center; margin-top: 5px; color: white; font-size: 1.2rem; }

        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .filter-bw { filter: grayscale(100%); } .filter-sepia { filter: sepia(60%); } .filter-vivid { filter: saturate(1.5) contrast(1.1); }
        
        /* FONTES NOVAS */
        .font-modern .pv-title { font-family: 'Poppins', sans-serif; } 
        .font-classic .pv-title { font-family: 'Playfair Display', serif; } 
        .font-hand .pv-title { font-family: 'Dancing Script', cursive; font-size: 2.6rem; }
        .font-bold .pv-title { font-family: 'Bebas Neue', sans-serif; font-size: 3.5rem; letter-spacing: 1px; }
        .font-marker .pv-title { font-family: 'Permanent Marker', cursive; font-size: 2.2rem; }

        .align-left .pv-msg { text-align: left; } .align-center .pv-msg { text-align: center; }
        
        .card-overlay { position: absolute; top:0; left:0; width:100%; height:100%; z-index: 1; pointer-events: none; transition: 0.3s; transform: translateZ(0); }
        .dimmer-light { background: rgba(0,0,0,0.2); } .dimmer-heavy { background: rgba(0,0,0,0.5); }
        
        /* TEXT GLOW */
        .text-glow .pv-title, .text-glow .pv-msg, .text-glow .pv-verse { text-shadow: 0 0 10px rgba(255,255,255,0.8), 0 0 20px rgba(255,255,255,0.5); }
        
        /* TYPEWRITER CURSOR */
        .cursor-blink { display: inline-block; width: 2px; height: 1em; background-color: currentColor; margin-left: 2px; animation: blink 1s step-end infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        .card-content-layer { position: relative; z-index: 5; width: 100%; transition: font-size 0.2s; text-shadow: 0 2px 10px rgba(0,0,0,0.05); transform: translateZ(30px); /* 3D Text */ }
        .pv-title { font-size: 1.8rem; font-weight: 800; margin-bottom: 12px; line-height: 1.1; letter-spacing: -0.5px; }
        .pv-ref { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; margin-bottom: 6px; font-weight: 600; }
        .pv-verse { font-style: italic; opacity: 0.9; margin-bottom: 15px; display: block; font-size: 0.9em; }
        .pv-msg { padding: 30px; border-radius: 24px; font-size: 0.95rem; line-height: 1.7; margin-bottom: 30px; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); color: #333; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: 0.3s; min-height: 100px; }
        .pv-footer { font-size: 0.7rem; opacity: 0.75; text-transform: uppercase; margin-top: auto; display: flex; align-items: center; justify-content: center; gap: 6px; font-weight: 600; letter-spacing: 0.5px; cursor: pointer; }
        .pv-footer:hover { opacity: 1; text-shadow: 0 0 5px rgba(255,255,255,0.5); }

        /* Ajuste para modo m√∫sica */
        .fmt-music .pv-msg { background: transparent; box-shadow: none; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.5); padding: 10px; }
        .fmt-music .pv-title { color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .fmt-music .pv-verse { color: rgba(255,255,255,0.9); }
        .fmt-music .pv-ref { color: rgba(255,255,255,0.8); }

        .t-clean { background: white; color: #1e293b; } .t-clean .pv-title { color: #e11d48; }
        .t-dark { background: #0f172a; color: white; } .t-dark .pv-msg { background: rgba(255,255,255,0.1); color: #e2e8f0; border: 1px solid rgba(255,255,255,0.1); } .t-dark .pv-title { color: #818cf8; }
        .t-gold { background: linear-gradient(135deg, #FDEB71 0%, #F8D800 100%); color: #5c4a08; } .t-gold .pv-msg { background: rgba(255,255,255,0.6); color: #423602; }
        .t-ocean { background: linear-gradient(to top, #30cfd0 0%, #330867 100%); color: white; } .t-ocean .pv-msg { background: rgba(255,255,255,0.15); color:white; border: 1px solid rgba(255,255,255,0.2); }
        .t-nature { background: linear-gradient(120deg, #d4fc79 0%, #96e6a1 100%); color: #14532d; } .t-nature .pv-msg { background: rgba(255,255,255,0.7); }
        .t-sunset { background: linear-gradient(to right, #fa709a 0%, #fee140 100%); color: #7f1d1d; } .t-sunset .pv-msg { background: rgba(255,255,255,0.8); }
        .t-royal { background: linear-gradient(to right, #6a11cb 0%, #2575fc 100%); color: white; } .t-royal .pv-msg { background: rgba(255,255,255,0.15); color:white; border: 1px solid rgba(255,255,255,0.2); }

        .actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn-action { border: none; padding: 18px; border-radius: 18px; font-weight: 600; color: white; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; transition: 0.2s; font-size: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-action:active { transform: scale(0.96); }
        .btn-share { background: #25D366; grid-column: span 2; box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3); }
        .btn-audio { background: #f43f5e; color: white; grid-column: span 2; }
        .btn-save { background: #3b82f6; } .btn-print { background: #64748b; } .btn-copy { background: #94a3b8; }

        .bottom-nav { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 85%; max-width: 380px; height: 70px; background: rgba(30, 41, 59, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 40px; display: flex; justify-content: space-around; align-items: center; z-index: 1000; box-shadow: 0 15px 40px rgba(0,0,0,0.3); padding: 0 10px; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        [data-theme="light"] .bottom-nav { background: rgba(255,255,255,0.9); border: 1px solid rgba(0,0,0,0.05); box-shadow: 0 15px 40px rgba(0,0,0,0.1); }
        .nav-item { background: none; border: none; color: rgba(255,255,255,0.4); cursor: pointer; width: 55px; height: 55px; border-radius: 50%; font-size: 1.3rem; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        [data-theme="light"] .nav-item { color: #94a3b8; }
        .nav-item.active { background: var(--primary); color: white; transform: translateY(-8px); box-shadow: 0 8px 20px rgba(225, 29, 72, 0.4); }

        #toast { visibility: hidden; background: #1e293b; color: #fff; text-align: center; border-radius: 50px; padding: 12px 24px; position: fixed; z-index: 2000; left: 50%; top: 20px; transform: translateX(-50%); font-size: 0.95rem; font-weight: 600; opacity: 0; transition: 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 8px; white-space: nowrap; }
        #toast.show { visibility: visible; opacity: 1; top: 40px; }

        @media print {
            body * { visibility: hidden; } #card-capture, #card-capture * { visibility: visible; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            #screen-preview { display: block !important; position: absolute; left: 0; top: 0; width: 100%; margin: 0; }
            .card-preview-wrapper { box-shadow: none; border: none; width: 100% !important; margin: 0 auto; filter: none !important; border-radius: 0; transform: none !important; }
            .bottom-nav, .actions-grid, header, .preview-controls, .studio-tools, .top-nav-bar, .format-bar, .slider-box, .scroll-tools { display: none !important; }
        }
    </style>
</head>
<body data-theme="light">

    <!-- PARTICLES BG (V25) -->
    <div id="particles"></div>

    <header>
        <div class="brand"><span>Sistema Vida</span><span>Clean 31.1</span></div>
        <div class="streak-badge" id="streakCounter" onclick="showStreakInfo()"><i class="fas fa-fire"></i> <span>1</span> Dia</div>
    </header>

    <div class="container">
        <div id="screen-editor" class="screen active">
            <div class="tools-section">
                <div class="section-title"><i class="fas fa-bolt" style="color:#f59e0b"></i> Gerador R√°pido</div>
                <div class="search-row">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="temaBusca" class="search-input" placeholder="Sobre o que quer falar?">
                    <button class="btn-magic" onclick="gerarConteudo()"><i class="fas fa-wand-magic-sparkles"></i></button>
                </div>
                <div class="cat-scroll">
                    <div class="cat-chip" onclick="setSearch('Sucesso')">üöÄ Sucesso</div>
                    <div class="cat-chip" onclick="setSearch('F√©')">‚úùÔ∏è F√©</div>
                    <div class="cat-chip" onclick="setSearch('Ansiedade')">üò∞ Ansiedade</div>
                    <div class="cat-chip" onclick="setSearch('Gym')">üí™ Treino</div>
                    <div class="cat-chip" onclick="setSearch('Amor')">‚ù§Ô∏è Amor</div>
                    <div class="cat-chip" onclick="setSearch('Gratid√£o')">üôè Gratid√£o</div>
                </div>
            </div>
            <div class="emoji-bar">
                <button type="button" class="btn-emoji-toggle" onclick="toggleEmojiGrid()"><i class="far fa-smile"></i> Galeria de Emojis <i class="fas fa-chevron-down"></i></button>
                <div class="emoji-grid" id="emojiContainer"></div>
            </div>
            <div class="form-group"><label>T√≠tulo</label><input type="text" id="titulo" class="track-input" placeholder="Ex: Bom Dia" oninput="updatePreview()"></div>
            <div class="form-group"><label>Subt√≠tulo / Vers√≠culo</label><textarea id="versiculo" rows="2" class="track-input" placeholder="Uma frase curta..." oninput="updatePreview()"></textarea><input type="text" id="referencia" class="track-input" placeholder="Refer√™ncia (Opcional)" style="margin-top: 8px;" oninput="updatePreview()"></div>
            <div class="form-group"><label>Mensagem Principal</label><textarea id="mensagem" rows="5" class="track-input" placeholder="Sua mensagem inspiradora aqui..." oninput="updatePreview()"></textarea></div>
            
            <div class="form-group"><label>Assinatura (Rodap√©)</label><input type="text" id="autor" class="track-input" placeholder="Seu Nome ou @Instagram" value="Sistema Vida" oninput="updatePreview()"></div>
            
            <div style="height: 80px;"></div>
        </div>

        <div id="screen-preview" class="screen">
            <div class="top-nav-bar">
                <button class="btn-back" onclick="navTo('editor')"><i class="fas fa-arrow-left"></i> Voltar</button>
                <button class="btn-inspire" onclick="gerarAleatorio()"><i class="fas fa-random"></i> Surpreenda-me</button>
            </div>

            <div class="slider-box">
                <div class="slider-row">
                    <div class="slider-wrapper">
                        <span class="slider-label">Tamanho</span>
                        <input type="range" id="fontSizeSlider" min="12" max="28" value="16" oninput="ajustarFonte(this.value)">
                    </div>
                    <div class="slider-wrapper">
                        <span class="slider-label">Opacidade</span>
                        <input type="range" min="0" max="100" value="90" oninput="ajustarOpacidade(this.value)">
                    </div>
                </div>
                <!-- NOVO SLIDER DE BLUR (V24) -->
                <div class="slider-wrapper">
                    <span class="slider-label">Desfoque do Fundo (Blur)</span>
                    <input type="range" min="0" max="10" value="0" oninput="ajustarBlur(this.value)">
                </div>
            </div>

            <!-- CONTAINER 3D -->
            <div class="preview-container-3d" id="card-container-3d">
                <div class="card-preview-wrapper fmt-feed t-clean font-modern align-left" id="card-capture">
                    <div class="card-sticker draggable-item" id="card-sticker">Bom Dia</div>
                    <div class="card-overlay" id="overlay-dim"></div>
                    <div class="card-content-layer">
                        <div id="pv-title" class="pv-title draggable-item">T√≠tulo</div>
                        <div id="pv-ref" class="pv-ref draggable-item">REF</div>
                        <span id="pv-verse" class="pv-verse draggable-item">"Texto..."</span>
                        
                        <!-- MSG with Typewriter logic -->
                        <div id="pv-msg" class="pv-msg draggable-item">Mensagem...</div>
                        
                        <div class="pv-footer draggable-item" id="pv-footer-container"><i class="fas fa-heart" style="color:var(--primary)"></i> <span id="pv-autor">Sistema Vida</span> ‚Ä¢ <span id="data-hoje" onclick="mudarData()">Data</span></div>
                    </div>

                    <!-- PLAYER MUSICAL (V23) -->
                    <div class="music-overlay">
                        <div class="music-bar"><div class="music-progress"></div></div>
                        <div class="music-time"><span>1:34</span><span>3:45</span></div>
                        <div class="music-controls">
                            <i class="fas fa-backward-step"></i>
                            <i class="fas fa-circle-play" style="font-size: 2.5rem;"></i>
                            <i class="fas fa-forward-step"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="format-bar">
                <div class="fmt-btn active" onclick="setFormat('fmt-feed', this)"><i class="far fa-square"></i> Feed</div>
                <div class="fmt-btn" onclick="setFormat('fmt-music', this)"><i class="fab fa-spotify"></i> Music</div>
                <div class="fmt-btn" onclick="setFormat('fmt-story', this)"><i class="fas fa-mobile-alt"></i> Stories</div>
            </div>

            <!-- MOLDURAS (V31) -->
            <div class="section-title" style="margin-left: 5px; margin-bottom: 10px; font-size: 0.75rem; font-weight: 700; color: var(--text-sec); text-transform: uppercase;">Molduras</div>
            <div class="preview-controls" style="padding-top: 0; margin-bottom: 20px;">
                <button class="tool-btn active" onclick="setFrame('')">üö´</button>
                <button class="tool-btn" onclick="setFrame('frame-white')">‚¨ú Simples</button>
                <button class="tool-btn" onclick="setFrame('frame-double')">Âõû Dupla</button>
                <button class="tool-btn" onclick="setFrame('frame-black')">‚¨õ Black</button>
                <button class="tool-btn" onclick="setFrame('frame-gold')">üëë Gold</button>
                <button class="tool-btn" onclick="setFrame('frame-wood')">ü™µ Madeira</button>
                <button class="tool-btn" onclick="setFrame('frame-neon-pink')">üîÆ Neon P</button>
                <button class="tool-btn" onclick="setFrame('frame-neon-blue')">üí† Neon A</button>
                <button class="tool-btn" onclick="setFrame('frame-modern-y')">‚¨ÜÔ∏è Top/Bot</button>
                <button class="tool-btn" onclick="setFrame('frame-modern-x')">‚¨ÖÔ∏è Lft/Rgt</button>
                <button class="tool-btn" onclick="setFrame('frame-polaroid-clean')">üì∏ Pola</button>
            </div>

            <div class="scroll-tools">
                <div class="tool-row">
                    <button class="tool-btn active" onclick="setSticker('', this)"><i class="fas fa-ban"></i></button>
                    <button class="tool-btn" onclick="setSticker('Bom Dia ‚òÄÔ∏è', this)">Bom Dia</button>
                    <button class="tool-btn" onclick="setSticker('Boa Noite üåô', this)">Boa Noite</button>
                    <button class="tool-btn" onclick="setSticker('Gratid√£o üôè', this)">Gratid√£o</button>
                    <button class="tool-btn" onclick="setSticker('F√© em Deus ‚úùÔ∏è', this)">F√©</button>
                    <button class="tool-btn" onclick="setSticker('Vers√≠culo üìñ', this)">Vers√≠culo</button>
                </div>

                <div class="tool-row">
                    <button class="tool-btn" onclick="toggleFont()"><i class="fas fa-font"></i> Fonte</button>
                    <button class="tool-btn" onclick="resetPositions()"><i class="fas fa-sync-alt"></i> Reset</button>
                    <button class="tool-btn" onclick="toggleTypewriter()"><i class="fas fa-keyboard"></i> Digitar</button> 
                    <button class="tool-btn" onclick="toggleAlign()"><i class="fas fa-align-center"></i> Alinhar</button>
                    <button class="tool-btn" onclick="toggleDim()"><i class="fas fa-adjust"></i> Sombra</button>
                    <button class="tool-btn" onclick="setFilter('filter-bw')">P&B</button>
                </div>
            </div>

            <div class="preview-controls">
                <button class="theme-btn upload-btn" onclick="document.getElementById('bgInput').click()">
                    <i class="fas fa-camera"></i>
                </button>
                <input type="file" id="bgInput" accept="image/*" style="display:none" onchange="carregarFoto(event)">

                <button class="theme-btn magic-btn" onclick="magicBackground()">
                    <i class="fas fa-wand-magic-sparkles"></i>
                </button>

                <div class="theme-btn t-clean active" onclick="setTheme('t-clean', this)"></div>
                <div class="theme-btn t-dark" onclick="setTheme('t-dark', this)"></div>
                <div class="theme-btn t-ocean" onclick="setTheme('t-ocean', this)"></div>
                <div class="theme-btn t-nature" onclick="setTheme('t-nature', this)"></div>
                <div class="theme-btn t-sunset" onclick="setTheme('t-sunset', this)"></div>
                <div class="theme-btn t-gold locked" onclick="setTheme('t-gold', this)" data-vip="true"></div>
                <div class="theme-btn t-royal locked" onclick="setTheme('t-royal', this)" data-vip="true"></div>
            </div>

            <div class="actions-grid">
                <button class="btn-action btn-audio" onclick="lerMensagem()"><i class="fas fa-volume-up"></i> Ouvir</button>
                <button class="btn-action btn-share" onclick="compartilharInteligente()"><i class="fab fa-whatsapp"></i> Enviar Zap</button>
                <button class="btn-action btn-save" onclick="baixar()"><i class="fas fa-download"></i> Salvar</button>
                <button class="btn-action btn-copy" onclick="copiarTexto()"><i class="fas fa-copy"></i> Copiar</button>
            </div>
            <div style="height: 100px;"></div>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="navTo('editor', this)"><i class="fas fa-pen"></i></button>
        <button class="nav-item" onclick="navTo('preview', this)"><i class="fas fa-image"></i></button>
        <button class="nav-item" onclick="toggleDarkMode()" id="btn-theme"><i class="fas fa-moon" id="icon-theme"></i></button>
    </nav>

    <div id="toast"><i class="fas fa-check-circle"></i> <span>Notifica√ß√£o</span></div>

    <script>
        const db = [
            { tags: "financeiro dinheiro sucesso", titulo: "Deus Prover√°", ref: "Filipenses 4:19", vers: "O meu Deus suprir√° todas as necessidades.", msg: "Sua conta banc√°ria n√£o limita o poder de Deus. A provis√£o est√° a caminho." },
            { tags: "sucesso trabalho foco", titulo: "N√£o Desista", ref: "G√°latas 6:9", vers: "N√£o nos cansemos de fazer o bem.", msg: "O sucesso √© a soma de pequenos esfor√ßos repetidos dia ap√≥s dia. Continue plantando." },
            { tags: "sucesso empreender", titulo: "Vis√£o de √Åguia", ref: "", vers: "O futuro pertence √†queles que acreditam na beleza de seus sonhos.", msg: "N√£o conte seus planos para quem n√£o tem vis√£o para entend√™-los. Trabalhe em sil√™ncio." },
            { tags: "ansiedade medo paz", titulo: "Paz Real", ref: "Jo√£o 14:27", vers: "Deixo-vos a paz, a minha paz vos dou.", msg: "Respire fundo. O controle do universo est√° nas m√£os de quem te ama." },
            { tags: "ansiedade calma", titulo: "Um dia de cada vez", ref: "Mateus 6:34", vers: "N√£o vos inquieteis pelo dia de amanh√£.", msg: "A preocupa√ß√£o n√£o tira os problemas de amanh√£, ela apenas tira a paz de hoje." },
            { tags: "fam√≠lia casa amor", titulo: "Lar Protegido", ref: "Josu√© 24:15", vers: "Eu e minha casa serviremos ao Senhor.", msg: "Deus est√° levantando muros de prote√ß√£o ao redor da sua fam√≠lia hoje." },
            { tags: "sa√∫de cura gym treino", titulo: "For√ßa Renovada", ref: "Isa√≠as 40:29", vers: "Ele fortalece o cansado e d√° grande vigor ao que est√° sem for√ßas.", msg: "Seu corpo √© templo. Cuide dele com respeito e disciplina. Voc√™ √© mais forte do que imagina." },
            { tags: "sa√∫de cura", titulo: "Cura Divina", ref: "Jeremias 30:17", vers: "Restaurarei a sua sa√∫de e curarei as suas feridas.", msg: "Para Deus, o diagn√≥stico m√©dico √© apenas um detalhe. Creia no milagre." },
            { tags: "gratid√£o f√©", titulo: "Novo F√¥lego", ref: "Lamenta√ß√µes 3:22", vers: "As miseric√≥rdias do Senhor s√£o a causa de n√£o sermos consumidos.", msg: "Voc√™ acordou! Isso √© a prova de que Deus ainda n√£o terminou com voc√™." },
            { tags: "f√© milagre", titulo: "Vai Acontecer", ref: "Hebreus 11:1", vers: "A f√© √© a certeza daquilo que esperamos.", msg: "O que parece imposs√≠vel para voc√™, para Deus √© apenas o come√ßo de um milagre." }
        ];

        const magicBackgrounds = [
            "https://images.unsplash.com/photo-1519681393798-3828fb4090bb?q=80&w=1000",
            "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?q=80&w=1000",
            "https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=1000",
            "https://images.unsplash.com/photo-1493246507139-91e8fad9978e?q=80&w=1000",
            "https://images.unsplash.com/photo-1472214103451-9374bd1c798e?q=80&w=1000",
            "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1000",
            "https://images.unsplash.com/photo-1513542789411-b6a5d4f31634?q=80&w=1000",
            "https://images.unsplash.com/photo-1506260408121-e353d10b87c7?q=80&w=1000",
            "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?q=80&w=1000",
            "https://images.unsplash.com/photo-1500673922987-e212871fec22?q=80&w=1000"
        ];

        const emojis = ["üôè", "üôå", "‚ú®", "‚ù§Ô∏è", "‚úùÔ∏è", "üïäÔ∏è", "üìñ", "üî•", "üí°", "üòä", "üí™", "üõ°Ô∏è", "üëë", "üåø", "üåü", "üíñ", "ü§ù", "üò≠", "üåª", "üòá", "ü¶Å", "üåà", "‚òÄÔ∏è", "üöÄ", "üí∞", "üíº", "üß†"];
        let lastInput = null;
        let userStreak = 0;
        let typeWriterActive = true; 
        let currentFrame = '';

        window.onload = function() {
            checkStreak();
            updateLockedThemes();
            createParticles();
            const ec = document.getElementById('emojiContainer');
            if(ec) { emojis.forEach(e => { const d=document.createElement('div'); d.className='emoji-item'; d.innerText=e; d.onclick=()=>insertEmoji(e); ec.appendChild(d); }); }
            document.querySelectorAll('.track-input').forEach(i=>i.addEventListener('focus', ()=>lastInput=i));
            lastInput = document.getElementById('mensagem');
            gerarConteudo();
            
            init3DTilt();
            initDraggable(); 
            initPinchZoom(); 
        };

        // --- FRAMES SYSTEM (V31) ---
        function setFrame(frameClass) {
            const card = document.getElementById('card-capture');
            
            // Remove previous frame classes
            const classesToRemove = ['frame-white', 'frame-black', 'frame-gold', 'frame-wood', 'frame-neon-pink', 'frame-neon-blue', 'frame-double', 'frame-modern-y', 'frame-modern-x', 'frame-polaroid-clean'];
            card.classList.remove(...classesToRemove);
            
            if(frameClass) {
                card.classList.add(frameClass);
            }
            currentFrame = frameClass;
            showToast("Moldura Aplicada! üñºÔ∏è");
        }

        // --- DRAG SYSTEM ---
        function initDraggable() {
            const draggables = document.querySelectorAll('.draggable-item');
            draggables.forEach(el => makeDraggable(el));
        }

        function makeDraggable(el) {
            let isDragging = false;
            let startX, startY, initialTranslateX, initialTranslateY;

            const getTranslate = (element) => {
                const style = window.getComputedStyle(element);
                const matrix = new WebKitCSSMatrix(style.transform);
                return { x: matrix.m41, y: matrix.m42 };
            };

            const start = (e) => {
                if(e.type === 'touchstart' && e.touches.length > 1) return;
                if(e.target.classList.contains('fa-pen')) return;

                isDragging = true;
                const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
                const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
                
                startX = clientX;
                startY = clientY;
                
                const translate = getTranslate(el);
                initialTranslateX = translate.x;
                initialTranslateY = translate.y;
                
                el.style.transition = 'none'; 
            };

            const move = (e) => {
                if (!isDragging) return;
                e.preventDefault(); 
                const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
                const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
                const dx = clientX - startX;
                const dy = clientY - startY;
                el.style.transform = `translate(${initialTranslateX + dx}px, ${initialTranslateY + dy}px)`;
            };

            const end = () => {
                isDragging = false;
                el.style.transition = 'transform 0.2s'; 
            };

            el.addEventListener('mousedown', start);
            el.addEventListener('touchstart', start, { passive: false });
            window.addEventListener('mousemove', move);
            window.addEventListener('touchmove', move, { passive: false });
            window.addEventListener('mouseup', end);
            window.addEventListener('touchend', end);
        }

        // --- PINCH ZOOM SYSTEM ---
        function initPinchZoom() {
            const container = document.getElementById('card-capture');
            let initialDist = 0;
            let initialSize = 16;

            container.addEventListener('touchstart', (e) => {
                if (e.touches.length === 2) {
                    e.preventDefault();
                    initialDist = Math.hypot(
                        e.touches[0].clientX - e.touches[1].clientX,
                        e.touches[0].clientY - e.touches[1].clientY
                    );
                    initialSize = parseInt(document.getElementById('fontSizeSlider').value);
                }
            }, { passive: false });

            container.addEventListener('touchmove', (e) => {
                if (e.touches.length === 2) {
                    e.preventDefault();
                    const dist = Math.hypot(
                        e.touches[0].clientX - e.touches[1].clientX,
                        e.touches[0].clientY - e.touches[1].clientY
                    );
                    
                    const delta = dist - initialDist;
                    let newSize = initialSize + (delta / 5);
                    newSize = Math.max(10, Math.min(40, newSize)); 
                    
                    ajustarFonte(newSize);
                    document.getElementById('fontSizeSlider').value = newSize; 
                }
            }, { passive: false });
        }

        function resetPositions() {
            document.querySelectorAll('.draggable-item').forEach(el => {
                el.style.transform = 'translate(0, 0)';
            });
            showToast("Posi√ß√µes Restauradas üîÑ");
        }

        function createParticles() {
            const container = document.getElementById('particles');
            const particleCount = 20;
            for(let i=0; i<particleCount; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                const size = Math.random() * 5 + 2;
                p.style.width = size + 'px';
                p.style.height = size + 'px';
                p.style.left = Math.random() * 100 + 'vw';
                p.style.animationDuration = (Math.random() * 10 + 10) + 's';
                p.style.animationDelay = (Math.random() * 5) + 's';
                container.appendChild(p);
            }
        }

        function runTypewriter(text) {
            const el = document.getElementById('pv-msg');
            el.innerHTML = ''; 
            if (!typeWriterActive) {
                el.innerText = text;
                return;
            }
            let i = 0;
            const speed = 25; 
            function type() {
                if (i < text.length) {
                    el.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    el.innerHTML += '<span class="cursor-blink">|</span>';
                }
            }
            type();
        }

        function toggleTypewriter() {
            typeWriterActive = !typeWriterActive;
            showToast(typeWriterActive ? "Digita√ß√£o Ligada" : "Digita√ß√£o Desligada");
            updatePreview(); 
        }

        function init3DTilt() {
            const container = document.getElementById('card-container-3d');
            const card = document.getElementById('card-capture');
            
            container.addEventListener('mousemove', (e) => {
                const rect = container.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const rotateX = ((y - centerY) / centerY) * -10; 
                const rotateY = ((x - centerX) / centerX) * 10;
                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            });
            
            container.addEventListener('mouseleave', () => {
                card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
            });
        }

        function checkStreak() {
            let last = localStorage.getItem('lastVisit');
            userStreak = parseInt(localStorage.getItem('streak') || 0);
            const today = new Date().toDateString();
            if (last !== today) { 
                const yesterday = new Date(Date.now() - 86400000).toDateString();
                if (last === yesterday) userStreak++; else { if(last) userStreak = 1; else userStreak = 1; }
                localStorage.setItem('lastVisit', today); localStorage.setItem('streak', userStreak); 
            }
            if(document.querySelector('#streakCounter span')) document.querySelector('#streakCounter span').innerText = userStreak;
        }

        function updateLockedThemes() {
            const vips = document.querySelectorAll('[data-vip="true"]');
            vips.forEach(btn => { if (userStreak >= 3) btn.classList.remove('locked'); else btn.classList.add('locked'); });
        }

        function showStreakInfo() {
            if(userStreak >= 3) showToast("üî• Voc√™ √© VIP!");
            else { const faltam = 3 - userStreak; showToast(`üîí Faltam ${faltam} dias para liberar temas!`); }
        }

        function ajustarFonte(val) { document.querySelector('.card-content-layer').style.fontSize = val + 'px'; }
        function ajustarOpacidade(val) { document.getElementById('pv-msg').style.backgroundColor = `rgba(255,255,255, ${val / 100})`; }
        
        function ajustarBlur(val) {
            const card = document.getElementById('card-capture');
            if (card.style.backgroundImage) {
               document.getElementById('overlay-dim').style.backdropFilter = `blur(${val}px)`;
               document.getElementById('overlay-dim').style.webkitBackdropFilter = `blur(${val}px)`;
            }
        }

        function setFormat(fmt, btn) {
            const card = document.getElementById('card-capture');
            card.classList.remove('fmt-feed', 'fmt-square', 'fmt-story', 'fmt-music');
            card.classList.add(fmt);
            document.querySelectorAll('.fmt-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            resetPositions();

            if(fmt === 'fmt-music') {
                magicBackground(); 
                showToast("Modo M√∫sica Ativado üéµ");
            } else {
                showToast("Formato Alterado");
            }
        }

        function setSticker(text, btn) {
            const el = document.getElementById('card-sticker');
            if(!text) { el.classList.remove('visible'); showToast("Selo removido"); }
            else { el.innerText = text; el.classList.add('visible'); showToast("Selo aplicado"); }
            btn.parentElement.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function setTheme(themeClass, btn) {
            if (btn && btn.classList.contains('locked')) { showStreakInfo(); return; }
            const card = document.getElementById('card-capture');
            const currentClasses = Array.from(card.classList);
            currentClasses.forEach(cls => { if(cls.startsWith('t-')) card.classList.remove(cls); });
            card.classList.add(themeClass); card.style.backgroundImage = '';
            
            // Reapply frame if exists
            if(currentFrame) card.classList.add(currentFrame);

            card.classList.remove('filter-bw', 'filter-sepia', 'filter-vintage', 'filter-vivid');
            document.getElementById('overlay-dim').className = 'card-overlay'; 
            document.getElementById('overlay-dim').style.backdropFilter = 'none'; // Reset blur
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
        }

        function magicBackground() {
            const card = document.getElementById('card-capture');
            const randomImg = magicBackgrounds[Math.floor(Math.random() * magicBackgrounds.length)];
            card.style.backgroundImage = `url(${randomImg})`;
            card.style.backgroundSize = 'cover';
            card.style.backgroundPosition = 'center';
            const currentClasses = Array.from(card.classList);
            currentClasses.forEach(cls => { if(cls.startsWith('t-')) card.classList.remove(cls); });
            card.classList.add('t-dark');
            if(currentFrame) card.classList.add(currentFrame);
            document.getElementById('overlay-dim').className = 'card-overlay dimmer-heavy';
            const msg = document.getElementById('mensagem');
            if(msg.value && !msg.value.includes('‚ú®')) { msg.value += " ‚ú®"; updatePreview(); }
            showToast("‚ú® M√°gica Aplicada!");
        }

        function mudarData() {
            const novaData = prompt("Digite a data:", document.getElementById('data-hoje').innerText);
            if(novaData) { document.getElementById('data-hoje').innerText = novaData; showToast("Data alterada!"); }
        }

        function lerMensagem() {
            if (!('speechSynthesis' in window)) {
                alert("Seu navegador n√£o suporta √°udio.");
                return;
            }

            const synth = window.speechSynthesis;
            
            if (synth.speaking) {
                synth.cancel();
                showToast("üîá √Åudio parado.");
                return;
            }

            const t = document.getElementById('titulo').value || "";
            const m = document.getElementById('mensagem').value || "";
            
            if (!t && !m) {
                showToast("Nada para ler.");
                return;
            }

            const textToRead = `${t}. ${m}`;
            const utter = new SpeechSynthesisUtterance(textToRead);
            
            utter.lang = 'pt-BR';
            utter.rate = 0.9;
            utter.pitch = 1;

            const voices = synth.getVoices();
            const brVoice = voices.find(v => v.lang.includes('pt-BR') || v.lang.includes('pt_BR'));
            if (brVoice) utter.voice = brVoice;

            utter.onstart = () => showToast("üîä Lendo...");
            utter.onend = () => showToast("‚úÖ Leitura conclu√≠da.");
            utter.onerror = (e) => console.error("Erro na fala:", e);

            synth.speak(utter);
        }

        function toggleDarkMode() {
            const body = document.body;
            const icon = document.getElementById('icon-theme');
            const current = body.getAttribute('data-theme');
            if (current === 'light') { body.setAttribute('data-theme', 'dark'); icon.classList.remove('fa-moon'); icon.classList.add('fa-sun'); showToast("Modo Escuro Ativado"); } 
            else { body.setAttribute('data-theme', 'light'); icon.classList.remove('fa-sun'); icon.classList.add('fa-moon'); showToast("Modo Claro Ativado"); }
        }

        function carregarFoto(e) {
            const input = e.target ? e.target : e;
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    const card = document.getElementById('card-capture');
                    card.style.backgroundImage = `url(${evt.target.result})`;
                    card.style.backgroundSize = 'cover'; card.style.backgroundPosition = 'center';
                    const currentClasses = Array.from(card.classList);
                    currentClasses.forEach(cls => { if(cls.startsWith('t-')) card.classList.remove(cls); });
                    card.classList.add('t-dark');
                    if(currentFrame) card.classList.add(currentFrame);
                    document.getElementById('overlay-dim').className = 'card-overlay dimmer-heavy';
                    showToast("Foto Carregada! üì∏");
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        let fontState = 0;
        function toggleFont() {
            const fonts = ['font-modern', 'font-classic', 'font-hand', 'font-bold', 'font-marker'];
            const card = document.getElementById('card-capture');
            card.classList.remove(...fonts); fontState = (fontState + 1) % fonts.length; card.classList.add(fonts[fontState]);
            showToast("Fonte alterada");
        }
        function toggleAlign() {
            const card = document.getElementById('card-capture');
            if(card.classList.contains('align-left')) { card.classList.replace('align-left', 'align-center'); showToast("Centralizado"); }
            else { card.classList.replace('align-center', 'align-left'); showToast("Esquerda"); }
        }
        function toggleDim() {
            const el = document.getElementById('overlay-dim');
            if(el.className === 'card-overlay') el.className = 'card-overlay dimmer-light';
            else if(el.className === 'card-overlay dimmer-light') el.className = 'card-overlay dimmer-heavy';
            else el.className = 'card-overlay';
            showToast("Sombra ajustada");
        }
        function toggleGlow() {
            const card = document.getElementById('card-capture');
            card.classList.toggle('text-glow');
            showToast(card.classList.contains('text-glow') ? "Neon Ligado ‚ú®" : "Neon Desligado");
        }
        function setFilter(cls) {
            const card = document.getElementById('card-capture');
            card.classList.remove('filter-bw', 'filter-sepia', 'filter-vintage', 'filter-vivid');
            if(cls) card.classList.add(cls);
            showToast("Filtro aplicado");
        }
        function gerarAleatorio() {
            const item = db[Math.floor(Math.random() * db.length)];
            document.getElementById('titulo').value = item.titulo; document.getElementById('versiculo').value = item.vers;
            document.getElementById('referencia').value = item.ref; document.getElementById('mensagem').value = item.msg;
            let temas = ['t-clean', 't-dark', 't-ocean', 't-nature', 't-sunset'];
            if(userStreak >= 3) temas.push('t-gold', 't-royal');
            setTheme(temas[Math.floor(Math.random() * temas.length)], null);
            toggleFont(); showToast("‚ú® Inspira√ß√£o!"); updatePreview();
        }

        function setSearch(term) { document.getElementById('temaBusca').value = term; gerarConteudo(); }
        function gerarConteudo() {
            const t = document.getElementById('temaBusca').value.toLowerCase();
            const pool = t ? db.filter(i => i.tags.includes(t)) : db;
            const item = pool.length ? pool[Math.floor(Math.random() * pool.length)] : db[0];
            document.getElementById('titulo').value = item.titulo; document.getElementById('versiculo').value = item.vers;
            document.getElementById('referencia').value = item.ref; document.getElementById('mensagem').value = item.msg;
            showToast("Texto Gerado!");
            if(t) navTo('preview', document.querySelectorAll('.nav-item')[1]);
        }
        
        function updatePreview() {
            document.getElementById('pv-title').innerText = document.getElementById('titulo').value || "T√≠tulo";
            document.getElementById('pv-verse').innerText = `"${document.getElementById('versiculo').value}"`;
            document.getElementById('pv-ref').innerText = document.getElementById('referencia').value || "Ref";
            const msgText = document.getElementById('mensagem').value || "Mensagem...";
            runTypewriter(msgText);
            const autor = document.getElementById('autor').value;
            document.getElementById('pv-autor').innerText = autor || "Sistema Vida";
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('data-hoje').innerText = new Date().toLocaleDateString('pt-BR', options);
        }
        
        function toggleEmojiGrid() { document.getElementById('emojiContainer').classList.toggle('show'); }
        function insertEmoji(char) { if(lastInput) { lastInput.value += char; showToast("Emoji Adicionado!"); } }

        async function compartilharInteligente() {
            const card = document.getElementById('card-capture'); 
            const msgBox = document.getElementById('pv-msg');
            const originalHtml = msgBox.innerHTML;
            
            card.style.transform = 'none';
            if(msgBox.innerHTML.includes('cursor-blink')) { msgBox.innerHTML = msgBox.innerText.replace('|', ''); }
            
            showToast("Gerando imagem...");
            try {
                const canvas = await html2canvas(card, { scale: 2, useCORS: true, allowTaint: true, backgroundColor: null });
                canvas.toBlob(async (blob) => {
                    msgBox.innerHTML = originalHtml;
                    const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
                    if (isMobile && navigator.share) {
                        const file = new File([blob], "sistema_vida.png", { type: "image/png" });
                        navigator.share({ files: [file], title: 'Sistema Vida', text: 'Minha mensagem do dia!' }).catch(() => {});
                    } else {
                        try {
                            const item = new ClipboardItem({ "image/png": blob });
                            await navigator.clipboard.write([item]);
                            showToast("Imagem COPIADA! Cole no WhatsApp.");
                            setTimeout(() => { window.open("https://web.whatsapp.com", "_blank"); }, 1500);
                        } catch (err) { baixarLink(canvas); }
                    }
                });
            } catch (error) { 
                baixar(); 
            }
        }
        function baixar() {
            const card = document.getElementById('card-capture'); 
            
            card.style.transform = 'none'; 

            showToast("Salvando...");
            html2canvas(card, { scale: 3, useCORS: true, allowTaint: true, backgroundColor: null }).then(canvas => { 
                baixarLink(canvas); 
            }).catch(e => { alert("Erro ao baixar."); });
        }
        function baixarLink(canvas) {
            const link = document.createElement('a'); link.download = 'sistema_vida_' + Date.now() + '.png'; link.href = canvas.toDataURL(); link.click(); showToast("Salvo na Galeria! üì•");
        }
        function copiarTexto() {
            const t = document.getElementById('titulo').value; const v = document.getElementById('versiculo').value; const m = document.getElementById('mensagem').value;
            const a = document.getElementById('autor').value;
            const texto = `*${t}*\n\n"${v}"\n\n${m}\n\n_${a}_`;
            navigator.clipboard.writeText(texto).then(() => showToast("Texto copiado!"));
        }
        function navTo(screenId, btn) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-' + screenId).classList.add('active');
            if(btn) { document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
            if(screenId === 'preview') updatePreview(); window.scrollTo(0,0);
        }
        function showToast(msg) {
            const t = document.getElementById('toast'); 
            t.innerHTML = `<i class="fas fa-info-circle"></i> <span>${msg}</span>`;
            t.className = "show"; setTimeout(() => t.className = "", 3000);
        }
    </script>
</body>
</html>
